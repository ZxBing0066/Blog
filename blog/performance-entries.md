---
lastUpdate: 2022-10-18
date: 2022-10-18
---
# å¼ºå¤§çš„ performance API - PerformanceEntry ç¯‡ï¼ˆä½ æƒ³è¦çš„æ€§èƒ½æŒ‡æ ‡ï¼Œéƒ½é€ƒä¸è¿‡æˆ‘çš„æŒæ§ ğŸ«´ï¼‰

å¾ˆä¹…å‰å†™çš„ä¸€ç¯‡æ€§èƒ½ä¼˜åŒ–çš„æ–‡ç« ä¸­æœ‰æåˆ°æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `performance.now` æ¥è·å–ç¨‹åºè¿è¡Œçš„æ—¶é—´ï¼Œä»Šå¤©å†æ¥ä»‹ç»ä¸€ä¸ªé²œä¸ºäººçŸ¥å´åˆæ— æ¯”å¼ºå¤§çš„ `API` - `performance` ä¸­çš„ä¸€ä¸ªå¾ˆå¼ºå¤§çš„åŠŸèƒ½ï¼š`getEntries`ï¼Œç®€å•çš„è¯´é€šè¿‡ `getEntries` ç³»åˆ— `API`ï¼Œæµè§ˆå™¨ä¸­çš„è‡ªå¸¦çš„ä¸€åˆ‡æ€§èƒ½ç›¸å…³æŒ‡æ ‡æˆ‘ä»¬éƒ½å¯ä»¥ç›´æ¥è·å–åˆ°ï¼Œä¸‹é¢ä¸€èµ·æ¥çœ‹ä¸‹é‡Œé¢è—ç€å“ªäº›ä¿¡æ¯ã€‚

## performance.getEntries - è·å–é¡µé¢ä¸­çš„æ€§èƒ½æ•°æ®æ¡ç›®

å‰æ’å…ˆæé†’ä¸‹ï¼Œ`PerformanceEntry` ä¸­çš„æ—¶é—´ç›¸å…³æ•°æ®å…¨éƒ¨æ˜¯ç›¸å¯¹æ—¶é—´ï¼Œå³ä»è¿›å…¥é¡µé¢åˆ°è¯¥äº‹ä»¶å‘ç”Ÿçš„æ—¶é—´å·®ã€‚æˆ‘ä»¬å…ˆä¸ä»‹ç»ç›´æ¥ä¸Šæ‰‹ä½¿ç”¨ `getEntries` çœ‹ä¸‹è¾“å‡ºï¼š

```js
const entries = performance.getEntries();
```

åœ¨æ§åˆ¶å°æ‰§è¡Œä¸Šè¿°ä»£ç ï¼Œä½ å°†ä¼šå‘ç°æ‰“å°äº†ä¸€é•¿ä¸²çš„ `Performance*` å¯¹è±¡æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«å¦‚ `PerformanceNavigationTiming`ã€`PerformanceResourceTiming`ã€`PerformancePaintTiming` ç­‰ç­‰ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œæ•°ç»„çš„ç¬¬ä¸€é¡¹å°†ä¼šæ˜¯ `PerformanceNavigationTiming` å®ä¾‹ï¼Œæˆ‘ä»¬çœ‹ä¸‹é‡Œé¢æœ‰å“ªäº›ä¿¡æ¯ï¼š

## navigation - é¡µé¢å¯¼èˆªè€—æ—¶ä¿¡æ¯

```js
const performanceEntry = {
    connectEnd: 4.100000023841858,
    connectStart: 4.100000023841858,
    decodedBodySize: 144049,
    domComplete: 1328.7000000476837,
    domContentLoadedEventEnd: 1023.6000000238419,
    domContentLoadedEventStart: 1021,
    domInteractive: 964.8000000715256,
    domainLookupEnd: 4.100000023841858,
    domainLookupStart: 4.100000023841858,
    duration: 1330,
    encodedBodySize: 29554,
    entryType: 'navigation',
    fetchStart: 4.100000023841858,
    initiatorType: 'navigation',
    loadEventEnd: 1330,
    loadEventStart: 1329.4000000953674,
    name: 'https://github.com/',
    nextHopProtocol: 'h2',
    redirectCount: 0,
    redirectEnd: 0,
    redirectStart: 0,
    requestStart: 185.30000007152557,
    responseEnd: 906.9000000953674,
    responseStart: 855.7000000476837,
    secureConnectionStart: 4.100000023841858,
    serverTiming: [],
    startTime: 0,
    transferSize: 29854,
    type: 'navigate',
    unloadEventEnd: 0,
    unloadEventStart: 0,
    workerStart: 0
};
```

æˆ‘ä»¬æŒ‘å…¶ä¸­æ¯”è¾ƒå…¸å‹çš„å‡ ä¸ªå±æ€§è¯´ä¸€ä¸‹ï¼š

-   `domainLookupStart`ã€`domainLookupEnd` æ˜¯é¡µé¢ `DNS` æŸ¥æ‰¾çš„å¼€å§‹å’Œç»“æŸæ—¶é—´
-   `encodedBodySize`ã€`decodedBodySize` æ˜¯ `document` è¯·æ±‚çš„å‹ç¼©å‰åçš„å°ºå¯¸
-   `requestStart` ä¸º `document` è¯·æ±‚å¼€å§‹çš„æ—¶é—´ï¼Œ`responseStart` æ˜¯æœåŠ¡å™¨å“åº”çš„æ—¶é—´ï¼Œ`responseEnd` åˆ™æ˜¯æœåŠ¡å™¨å“åº”ååˆ°å“åº”ä½“æ¥æ”¶å®Œæˆçš„æ—¶é—´

å…¶å®ƒçš„è¿˜æœ‰å¾ˆå¤šå¾ˆå®¹æ˜“çœ‹å‡ºæ¥çš„å¦‚ `domComplete`ã€`domInteractive` ç­‰ï¼Œæ˜¯ä¸æ˜¯å‘ç°å¾ˆå¤šéœ€è¦ç»Ÿè®¡çš„æ€§èƒ½æŒ‡æ ‡éƒ½å¯ä»¥ç›´æ¥æ‹¿åˆ°ã€‚

## paint - ä½ æƒ³è¦çš„ FPã€FCP éƒ½åœ¨è¿™äº†

ä¸è¿‡æœ‰åŒå­¦å¯èƒ½ä¼šå‘ç°ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ `FP` å’Œ `FCP` æŒ‡æ ‡æ€ä¹ˆæ²¡çœ‹åˆ°å‘¢ï¼Ÿåˆ«æ€¥ï¼Œæˆ‘ä»¬æŠŠåˆ°æ•°ç»„æœ€åçœ‹çœ‹ï¼Œå¯ä»¥çœ‹åˆ°ä¸¤ä¸ª `PerformancePaintTiming` å¯¹è±¡ï¼Œè¿™å°±æ˜¯ä½ æƒ³è¦æ‰¾çš„äº†ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹çœ‹æ•°æ®ï¼š

```js
const performanceEntryFP = {
    name: 'first-paint',
    entryType: 'paint',
    startTime: 804.6000000238419,
    duration: 0
};
const performanceEntryFCP = {
    name: 'first-contentful-paint',
    entryType: 'paint',
    startTime: 804.6000000238419,
    duration: 0
};
```

ç®€å•ç²—æš´ï¼Œå°±ä¸€ä¸ª `startTime`ã€‚ï¼ˆæ³¨æ„æ­¤å¤„çš„ `duration` æ˜¯ä¸ªæ‘†è®¾ï¼Œæ°¸è¿œä¸º 0ï¼Œåº”è¯¥æ˜¯å®ç°çš„çˆ¶ç±»çš„å±æ€§ï¼‰

ä¸Šé¢å·²ç»å¯ä»¥æ»¡è¶³æˆ‘ä»¬å¹³æ—¶è¦ä¸ŠæŠ¥çš„æ€§èƒ½æŒ‡æ ‡çš„å¤§éƒ¨åˆ†éœ€æ±‚ã€‚ç„¶è€Œ `PerformanceEntry` ä¸­å¯è¿œä¸æ­¢è¿™äº›ï¼Œå¦‚æœä½ çš„é¡µé¢åŠ è½½åä½ åœ¨é¡µé¢ä¸­è¿›è¡Œè¿‡ä»»ä½•æ“ä½œå¦‚é¼ æ ‡ç‚¹å‡»ã€è¾“å…¥ç­‰æ“ä½œï¼Œé‚£ä½ ä¼šçœ‹åˆ°ä¸€æ¡ `PerformanceEventTiming` è®°å½•ï¼Œä½†æ˜¯åœ¨é‚£ä¹‹å‰ï¼Œä¸ºäº†è®©æˆ‘ä»¬èƒ½å¤Ÿæ›´ç²¾ç¡®å¿«é€Ÿçš„è·å–åˆ°æˆ‘ä»¬æƒ³è¦çš„ `PerformanceEntry` æ¡ç›®ï¼Œæˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸‹å¦å¤–ä¸¤ä¸ª `API`ï¼š`getEntriesByName` å’Œ `getEntriesByType`ã€‚

## getEntriesByType - è·å–æŒ‡å®šçš„æ€§èƒ½æ•°æ®æ¡ç›®

`getEntriesByType` å¯ä»¥ä¼ å…¥ `PerformanceEntry` çš„ `type` è®©æˆ‘ä»¬è¿‡æ»¤å‡ºæˆ‘ä»¬åˆ¶å®šç±»å‹çš„æ€§èƒ½æ•°æ®æ¡ç›®ï¼Œæ¯”å¦‚ä¸Šé¢çš„ `PerformanceNavigationTiming` çš„ `entryType` å³ `navigation`ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ç›´æ¥ä½¿ç”¨ `performance.getEntriesByType('navigation');` æ¥è·å–ï¼Œå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ `filter` ç­›é€‰ã€‚

## first-input - ç”¨æˆ·é¦–æ¬¡æ“ä½œè®°å½•

ä¸‹é¢æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬åˆšåˆšè¯´åˆ°çš„é‚£æ¡ `PerformanceEventTiming` è®°å½•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `performance.getEntriesByType('first-input')` æ¥è·å–è¯¥æ¡è®°å½•ï¼Œè·å–å‰åƒä¸‡è®°å¾—è¦å…ˆæ‰§è¡Œä¸€æ¬¡æ“ä½œï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å…¶ä¸­çš„æ•°æ®ï¼š

```js
const performanceEntry = {
    name: 'pointerdown',
    entryType: 'first-input',
    startTime: 2077.7000000476837,
    duration: 16,
    processingStart: 2080.4000000953674,
    processingEnd: 2080.600000023842,
    cancelable: true
};
```

å“‡å“¦ï¼Œå¯ä»¥çœ‹åˆ° `performance` ä¸­å¸®æˆ‘ä»¬è®°å½•äº†æ“ä½œçš„å¼€å§‹æ—¶é—´ã€æ‰§è¡Œè€—æ—¶ã€äº‹ä»¶ç±»å‹ï¼ŒçœŸæ˜¯æ£’æ£’çš„ã€‚

ä¸è¿‡å…ˆä¸è¦æ€¥ç€æ„Ÿå¹ï¼Œè¿˜æœ‰æ›´å‰å®³çš„ã€‚

## resource - æ‰€æœ‰çš„è¯·æ±‚ï¼Œéƒ½èƒ½åœ¨æˆ‘è¿™é‡Œæ‰¾åˆ°

æˆ‘ä»¬åœ¨å°è¯•ä¸€ä¸‹ä½¿ç”¨ `performance.getEntriesByType('resource')`ï¼Œå¦‚æœä½ æµ‹è¯•çš„ç½‘é¡µè¾ƒå¤§ï¼Œä½ ä¼šå‘ç°è¿™æ¬¡è¿”å›äº†è¶…å¤šçš„æ•°æ®ï¼Œæ•°æ®æ¡ç›®ä¸­çš„ `initiatorType` åŒ…æ‹¬å„ç§ `script`ã€`img`ã€`link`ã€`xmlhttprequest`ã€`fetch` ç­‰ç­‰ï¼Œç®€å•è¯´å‡ºäº† `document` è¯·æ±‚ï¼Œæ‰€æœ‰çš„å…¶å®ƒè¯·æ±‚çš„æ•°æ®éƒ½åœ¨è¿™é‡Œäº†ï¼Œå“‡å“¦ã€‚è¿™äº›æ•°æ®æ¡ç›®ä¸­çš„å±æ€§åŸºæœ¬ä¸€è‡´ï¼Œå¹¶ä¸”ä¸ `navigation` æ¡ç›®å­˜åœ¨å¾ˆé«˜çš„é‡åˆåº¦ï¼Œå› ä¸º `navigation` æœ¬èº«åŒ…å«äº† `document` è¯·æ±‚çš„æ€§èƒ½æ•°æ®ï¼Œè¿™é‡Œä¸åœ¨é‡å¤è´´æ•°æ®å†…å®¹ï¼Œæœ‰å…´è¶£çš„è‡ªè¡Œæ‰“å¼€ `console` è¯•ä¸€ä¸‹å°±è¡Œäº†ã€‚

é€šè¿‡ `resource` ç±»çš„æ•°æ®æ¡ç›®ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ˜“çš„è·å–åˆ°å‰ç«¯å„ç§èµ„æºçš„åŠ è½½è€—æ—¶ã€èµ„æºå¤§å°ç­‰ç­‰ï¼Œå¹¶ä¸”ç”±äºè¯·æ±‚çš„æ•°æ®ä¹Ÿä¸€æ ·å¯ä»¥è·å–åˆ°ï¼Œä»¥åå°±å¯ä»¥åœ¨ `API` æ…¢çš„æ—¶å€™æ‹¿ç€æ•°æ®å»æ‰¾åç«¯çš„èŒ¬äº†ï¼Œæœ‰ç†æœ‰æ®ï¼ˆğŸ¶ ä¿å‘½ï¼‰ã€‚

çœ‹åˆ°è¿™é‡Œç›¸ä¿¡ä¸çŸ¥é“ `performance` çš„å·²ç»åæ‚”äº†ï¼Œåæ‚”æ²¡æ—©ç‚¹çŸ¥é“å¯¼è‡´è‡ªå·±åœ¨æ€§èƒ½ä¸ŠæŠ¥æ—¶æ‰“äº†åŸ‹äº†ä¸€å †ç‚¹åˆ°æœ€åè¿˜ä¸çŸ¥é“æ—¶é—´é ä¸é è°±ã€‚ä¸è¿‡å…ˆåˆ«æ€¥ï¼Œè¿™è¿˜æ²¡å®Œã€‚

## mark å’Œ measure - è‡ªå®šä¹‰æ€§èƒ½åŸ‹ç‚¹çš„å¥½å¸®æ‰‹

`performance` è¿˜æä¾›äº† `mark` å’Œ `measure`ï¼Œè®©æˆ‘ä»¬å¯ä»¥è¿›è¡Œè‡ªå®šä¹‰æ€§èƒ½åŸ‹ç‚¹ã€‚é€šè¿‡è°ƒç”¨ `performance.mark('custom')` æˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸€æ¡è‡ªå®šä¹‰çš„ `mark` æ¡ç›®ï¼Œè¿˜å¯ä»¥åœ¨ç¬¬äºŒä¸ªå‚æ•°ä¸­ä¼ å…¥æˆ‘ä»¬æƒ³è¦è®°å½•çš„ä¿¡æ¯ã€‚

```js
performance.mark('custom', { detail: 'hahaha' });
// {
//     "name": "custom",
//     "entryType": "mark",
//     "startTime": 56635,
//     "duration": 0,
//     "detail": "hahaha"
// }
```

æ­¤å¤–ï¼Œé€šè¿‡é…åˆ `measure`ï¼Œä½ å¼€å¯ä»¥è½»æ¾è·å¾—ä¸¤ä¸ª `mark` ä¹‹é—´çš„è€—æ—¶ï¼š

```js
performance.mark('start');
doSomething();
performance.mark('end');
performance.measure('measure start to end', 'start', 'end');
```

ç„¶åä½ å°±ä¼šå¾—åˆ°ä¸€æ¡ `measure` æ¡ç›®ï¼š

```js
{
    "name": "measure start to end",
    "entryType": "measure",
    "startTime": 103982.20000004768,
    "duration": 2598.399999976158
}
```

å¹¶ä¸”ï¼Œåœ¨ `Chrome` ä¸­ä½ çš„ `mark` å’Œ `measure` ä¹Ÿä¼šåœ¨ `Performance` é¢æ¿ä¸­å‡ºç°ã€‚å¥½äº†ï¼Œè¿˜å¼€å‘ä»€ä¹ˆåŸ‹ç‚¹ç³»ç»Ÿï¼Œä¸€ä¸ª `performance` å…¨æå®šï¼Œåªéœ€è¦åšä¸ªæ•°æ®ç»Ÿè®¡å¹³å°å°±å®Œäº‹äº†ã€‚

## worker å°åŠ©æ‰‹ - è®©ä½ çš„æ€§èƒ½ä¸ŠæŠ¥ä¸ä»£ç è§£è€¦

é™¤äº†ä¸Šé¢é‚£äº›å¼ºå¤§çš„ `API` å¯ä»¥è®©æˆ‘ä»¬è·å–åˆ°å„ç§æ€§èƒ½æŒ‡æ ‡å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç›´æ¥åœ¨ `web worker` ä¸­ä½¿ç”¨ `performance` ç³»åˆ— `API`ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å½»åº•åšåˆ°æ€§èƒ½ä¸ŠæŠ¥ä¸ä»£ç çš„è§£è—•ï¼Œå¹¶ä¸”ä¸éœ€è¦æ‹…å¿ƒå¤„ç†æ€§èƒ½æ•°æ®æ—¶å½±å“ç¨‹åºçš„æ€§èƒ½ï¼Œç»„åˆæ‹³ï¼Œå¤ªé¦™äº†ã€‚

## æ€»ç»“

ä½¿ç”¨ `performance` æˆ‘ä»¬å¯ä»¥è½»æ¾çš„è·å¾—æµè§ˆå™¨çš„å„ç§æ€§èƒ½æŒ‡æ ‡ã€å‰ç«¯èµ„æºåŠ è½½æƒ…å†µã€åç«¯ `API` è¯·æ±‚è€—æ—¶ç­‰ç­‰ï¼Œç”šè‡³è¿˜å¯ä»¥é€šè¿‡ `mark` å’Œ `measure` æ¥æè‡ªå®šä¹‰äº‹ä»¶ï¼Œé…åˆ `web worker`ï¼Œç®€ç›´é¦™çš„ä¸è¡Œã€‚
