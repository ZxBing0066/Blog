---
title: å­¤é™‹å¯¡é—»äº†ï¼Œæ‰çŸ¥é“å·²ç»å¯ä»¥ç”¨ JS æ¥æ§åˆ¶ CSS åŠ¨ç”»äº†
description: "æœ€è¿‘ç¿» MDN çªç„¶å‘ç°ä¸€å¥—å« Web Animations API çš„ä¸œä¸œï¼Œç‚¹è¿›å»çœ‹æ‰çŸ¥é“ï¼ŒåŸæ¥æ˜¯ä¸€å¥—æ§åˆ¶ css animation çš„ APIï¼Œè€Œä¸”å·²ç»æœ‰æ®µæ—¶é—´äº† \U0001F926â€â™‚ï¸ï¼Œè€Œæˆ‘å±…ç„¶ä¸€ç›´ä¸çŸ¥é“..."
pubDate: '2022-08-17'
tags:
    - JavaScript
    - CSS
    - Animation
---

æœ€è¿‘ç¿» `MDN` çªç„¶å‘ç°ä¸€å¥—å« `Web Animations API` çš„ä¸œä¸œï¼Œç‚¹è¿›å»çœ‹æ‰çŸ¥é“ï¼ŒåŸæ¥æ˜¯ä¸€å¥—æ§åˆ¶ `css animation` çš„ `API`ï¼Œè€Œä¸”å·²ç»æœ‰æ®µæ—¶é—´äº† ğŸ¤¦â€â™‚ï¸ï¼Œè€Œæˆ‘å±…ç„¶ä¸€ç›´ä¸çŸ¥é“ã€‚

## ä»‹ç»

`Web Animations API` ä¸»è¦åŒ…å«ä¸¤ä¸ª `API`ï¼š`animate` æ¥æ‰§è¡ŒåŠ¨ç”»ï¼Œ`getAnimations` æ¥è·å–å½“å‰å…ƒç´ çš„åŠ¨ç”»ã€‚

å¹¶ä¸” `getAnimations` ä¸æ­¢å¯ä»¥è·å–åˆ° `animate` åˆ›å»ºçš„åŠ¨ç”»ï¼Œ`css` ä¸­çš„åŠ¨ç”»åŒæ ·å¯ä»¥è·å–åˆ°ã€‚

## getAnimations

å…ˆæ¥ä¸ªå° `Demo`ï¼š

https://code.juejin.cn/pen/7132756019978338315

å¦‚ä¸Š `Demo` æ‰€ç¤ºï¼Œé€šè¿‡ `getAnimations` æˆ‘ä»¬å¯ä»¥è·å–åˆ°å½“å‰å…ƒç´ çš„æ­£åœ¨è¿è¡Œçš„åŠ¨ç”»çš„ `Animate` å¯¹è±¡ï¼Œå¦‚æœä¼ å…¥å‚æ•° `{subtree: true}` è¿˜èƒ½è·å–åˆ°åŒ…æ‹¬å…¶æ‰€æœ‰å­å…ƒç´ ã€ä¼ªå…ƒç´ çš„åŠ¨ç”»ã€‚

é€šè¿‡æ‹¿åˆ°çš„ `animate`ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¹å…¶è¿›è¡Œå„ç§æ“ä½œï¼Œå¦‚ï¼š

-   `pause` - æš‚åœåŠ¨ç”»
-   `play` - æ’­æ”¾åŠ¨ç”»
-   `cancel` - å–æ¶ˆåŠ¨ç”»çŠ¶æ€
-   `reverse` - åå‘æ‰§è¡ŒåŠ¨ç”»åˆ°å¼€å§‹çŠ¶æ€
-   `finish` - ç›´æ¥è·³åˆ°åŠ¨ç”»ç»“æŸé˜¶æ®µ

æ­¤å¤–è¿˜æœ‰ä¸€äº›å…¶ä»–æ¯”è¾ƒå°‘ç”¨çš„æ–¹æ³•ï¼Œå¦‚ `commitStyles`ã€`persist` ç­‰ã€‚

é€šè¿‡ä¸Šè¿° `API`ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ˜“çš„é€šè¿‡ `JS` æ¥æ§åˆ¶åŠ¨ç”»çš„æ‰§è¡Œï¼Œè€Œä¸éœ€è¦åƒä»¥å‰ä¸€æ ·é€šè¿‡æ”¹å†™ `CSS` æ ·å¼æ¥æ§åˆ¶ã€‚

é™¤äº†ä¸Šè¿°çš„ä¸€äº›æ“ä½œæ–¹æ³•å¤–ï¼Œ`animate` ä¸­è¿˜æœ‰å¾ˆå¤šåŠ¨ç”»çš„å±æ€§ï¼ŒåŒ…æ‹¬è¿è¡ŒçŠ¶æ€çš„ `Promise`ã€`timeline`ã€`effect` ç­‰ã€‚

å…¶ä¸­å¦‚ `finished` ç­‰ `Promise` åœ¨åŠ¨ç”»æ§åˆ¶æ—¶ä¹Ÿå¾ˆå¥½ç”¨ï¼Œæ¯”å¦‚åˆ›å»ºä¸€ä¸ªåŠ¨ç”»åéœ€è¦åœ¨åŠ¨ç”»å®Œæˆååšä¸€äº›å¤„ç†ç›´æ¥ `await finished` å³å¯ï¼Œä¸éœ€è¦åƒä»¥å‰ä¸€æ ·ç›‘å¬ `dom` çŠ¶æ€æˆ–æ˜¯è®¾å®šå€’è®¡æ—¶ã€‚

å…¶å®ƒéœ€è¦äº†è§£çš„å¯ä»¥ç‚¹å‡»[è¿™é‡ŒæŸ¥çœ‹](https://developer.mozilla.org/en-US/docs/Web/API/Animation#methods)ã€‚

## animate

`animate` æ–¹æ³•åˆ™å¯é€šè¿‡ `JS` ç»™å…ƒç´ æ·»åŠ åŠ¨ç”»ï¼š`Element.animate(keyframes, options)`

```js
anim.animate(
    [{ transform: 'translateX(0)' }, { transform: 'translateX(100px)' }, { transform: 'translateX(0)' }],
    1000
);
```

è¿™é‡Œçš„ `keyframes` æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¸åŒäº `css keyframes`ï¼Œè¿™é‡Œä¸éœ€è¦å®šä¹‰æ¯ä¸€ä¸ªå…³é”®å¸§çš„ç™¾åˆ†æ¯”ï¼Œæ­¤å¤„ä¼šé»˜è®¤æŒ‰ç…§ç­‰æ¯”æ‹†åˆ†å…³é”®å¸§ï¼Œå¦‚æœéœ€è¦å®šä¹‰ç™¾åˆ†æ¯”ï¼Œå¯ç›´æ¥åœ¨å…³é”®å¸§ä¸­æ·»åŠ  `offset` å‚æ•°ï¼š

```js
anim.animate(
    [{ transform: 'translateX(0)' }, { transform: 'translateX(100px)', offset: 0.3 }, { transform: 'translateX(0)' }],
    1000
);
```

æ­¤å¤„ `keyframe` å‚æ•°ä¸»è¦åŒ…å«ä¸¤ç§å±æ€§ï¼Œç¬¬ä¸€ç§æ˜¯å¯¹åº”çš„ `css` å±æ€§çš„ `js` è¡¨ç¤ºï¼Œå¦‚ `left`ã€`paddingLeft`ã€`transform` ç­‰ï¼ˆæ³¨æ„æ­¤å¤„ `css` ä¸­çš„ `float`ã€`offset` éœ€è¦å†™æˆ `cssFloat`ã€`cssOffset`ï¼‰ï¼Œç¬¬äºŒç§æ˜¯ä¸Šé¢è¯´åˆ°çš„ `offset` ä¸€ç±»çš„é€šç”¨æ§åˆ¶å‚æ•°ï¼Œé™¤äº† `offset` å¤–ï¼Œè¿˜å¯è®¾ç½® `easing` ä¸ºæ¯ä¸ªå…³é”®å¸§è®¾å®šåŠ¨ç”»æ›²çº¿ï¼š

```js
anim.animate([{ opacity: 1, easing: 'ease-out' }, { opacity: 0.1, easing: 'ease-in' }, { opacity: 0 }], 1000);
```

ä»¥åŠ `composite` å‚æ•°æ¥æ§åˆ¶åŠ¨ç”»åˆæˆæ–¹å¼ã€‚

æ­¤å¤–ï¼Œ`keyframes` è¿˜æ”¯æŒç¬¬äºŒç§æ ¼å¼ï¼š

```js
anim.animate(
    {
        opacity: [0, 0.9, 1],
        offset: [0, 0.8], // Shorthand for [ 0, 0.8, 1 ]
        easing: ['ease-in', 'ease-out']
    },
    1000
);
```

å¯ç›´æ¥ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼Œå°†å¯¹è±¡ä¸­çš„å±æ€§é€šè¿‡æ•°ç»„è¡¨ç¤ºæ¥è¡¨ç¤ºå¯¹åº”çš„å…³é”®å¸§ã€‚

`options` åˆ™å¯ä»¥ç›´æ¥ä¼ å…¥æ•°å­—ï¼Œä»£è¡¨åŠ¨ç”»äº‹ä»¶æˆ–æ˜¯ä¼ å…¥åŠ¨ç”»å‚æ•°ï¼š

```js
anim.animate([{ transform: 'translateX(0)' }, { transform: 'translateX(100px)' }, { transform: 'translateX(0)' }], {
    duration: 1000
});
```

å‚æ•°å’Œ `CSS` ä¸­å·®ä¸å¤šï¼ŒåŒ…æ‹¬ï¼š

-   `delay` - åŠ¨ç”»å»¶è¿Ÿ
-   `direction` - åŠ¨ç”»è¿è¡Œæ–¹å‘
-   `duration` - åŠ¨ç”»è¿è¡Œæ—¶é—´
-   `easing` - åŠ¨ç”»è¿è¡Œæ›²çº¿
-   `endDelay` - åŠ¨ç”»ç»“æŸåçš„å»¶è¿Ÿ
-   `fill` - åŠ¨ç”»å®Œæˆåçš„å¡«å……
-   `iterations` - åŠ¨ç”»é‡å¤æ¬¡æ•°
-   `composite` - åŠ¨ç”»åˆæˆ

æ­¤å¤–è¿˜æœ‰ `iterationStart`ã€`iterationComposite`ï¼Œéœ€è¦äº†è§£å¯[ç‚¹å‡»æŸ¥çœ‹](https://developer.mozilla.org/en-US/docs/Web/API/KeyframeEffect/KeyframeEffect#parameters)ã€‚

## å…¼å®¹å’Œ polyfill

å½“ç„¶ï¼Œè¯¥ç³»åˆ— `API` å…¼å®¹å¹¶ä¸ä½³ï¼Œè¦èƒ½å¤Ÿå®Œæ•´ä½“éªŒéœ€è¦è‡³å°‘ `Chrome` 84 ä»¥ä¸Šç‰ˆæœ¬ï¼Œ`IE` åˆ™å®Œå…¨æ²¡æˆã€‚

ä¸è¿‡è¿˜å¥½æœ‰ `polyfill` çš„å­˜åœ¨ï¼š[web-animations-js](https://github.com/web-animations/web-animations-js)

## æ€»ç»“

é€šè¿‡ `Web Animations` ç³»åˆ— `API` å¯ä»¥æ–¹ä¾¿çš„æ§åˆ¶å·²æœ‰çš„ `CSS` åŠ¨ç”»ã€æ·»åŠ åŠ¨ç”»ç­‰ï¼Œè€Œä¸éœ€è¦åƒä»¥å‰ä¸€æ ·ä½¿ç”¨ `JS` æ¥æ¨¡æ‹ŸåŠ¨ç”»ï¼Œåœ¨æŸäº›ç‰¹å®šåœºæ™¯ä¸‹å¯ä»¥æé«˜åŠ¨ç”»æ€§èƒ½ã€ç®€åŒ–åŠ¨ç”»ä»£ç ã€‚